# 통계학 6주차 정규과제

📌통계학 정규과제는 매주 정해진 분량의 『*데이터 분석가가 반드시 알아야 할 모든 것*』 을 읽고 학습하는 것입니다. 이번 주는 아래의 **Statistics_6th_TIL**에 나열된 분량을 읽고 `학습 목표`에 맞게 공부하시면 됩니다.

아래의 문제를 풀어보며 학습 내용을 점검하세요. 문제를 해결하는 과정에서 개념을 스스로 정리하고, 필요한 경우 추가자료와 교재를 다시 참고하여 보완하는 것이 좋습니다.

6주차는 `3부. 데이터 분석하기`를 읽고 새롭게 배운 내용을 정리해주시면 됩니다.


## Statistics_6th_TIL

### 3부. 데이터 분석하기
### 12.통계 기반 분석 방법론



## Study Schedule

|주차 | 공부 범위     | 완료 여부 |
|----|----------------|----------|
|1주차| 1부 p.2~56     | ✅      |
|2주차| 1부 p.57~79    | ✅      | 
|3주차| 2부 p.82~120   | ✅      | 
|4주차| 2부 p.121~202  | ✅      | 
|5주차| 2부 p.203~254  | ✅      | 
|6주차| 3부 p.300~356  | ✅      | 
|7주차| 3부 p.357~615  | 🍽️      |

<!-- 여기까진 그대로 둬 주세요-->

# 12.통계 기반 분석 방법론

```
✅ 학습 목표 :
* 주성분 분석(PCA)의 개념을 설명할 수 있다.
* 다중공선성을 진단할 수 있다.
* Z-TEST와 T-TEST의 개념을 비교하고, 적절한 상황에서 검정을 설계하고 수행할 수 있다.
* ANOVA TEST를 활용하여 세 개 이상의 그룹 간 평균 차이를 검정하고, 사후검정을 수행할 수 있다.
* 카이제곱 검정을 통해 범주형 변수 간의 독립성과 연관성을 분석하는 방법을 설명할 수 있다.
```

## 12.1. 분석 모델 개요
💡 데이터 분석 방법론은 *통계 모델*과 *기계 학습*으로 나눠짐
| **통계 모델** | **기계 학습** | 
| --------------| -------------- |
| 규칙 기반 | 학습 기반 |
| 해석 목적 | 예측 목적 |
| 논리성 | 복잡성 |

![statweek_1](/git_stat/12.1.png)
![statweek_2](/git_stat/12.2.png)

1. 지도 학습
- 입력에 대한 정답이 주어져서 출력된 결괏값-정답 오차가 줄어들도록 학습과 모델 수정 반복
2. 비지도 학습
- 별도의 정답 없이 변수 간의 패턴을 파악하거나 데이터를 군집화
- 차원 축소/군집 분석/연관 규칙
3. 강화 학습
- 시행착오를 통해 학습하는 과정
- 모델이 스스로 학습하게 하는 것것

## 12.2. 주성분 분석(PCA)
| **정의** | 여러 개의 독립변수를 잘 설명하는 주된 성분을 추출 -> 독립변수의 수를 줄임 |
| **목적** | 변수의 수를 줄여 모형을 간단하게 만들고 결과를 효과적으로 해석할 수 있음 |
| **조건** | 사용되는 변수들이 모두 양적변수 + 관측치들이 서로 독립적이고 정규분포 |

✅ 차원 축소는 두 가지로 구분됨됨
1. 변수 선택을 통해 비교적 불필요하거나 유의성이 낮은 변수 제거
2. 변수들의 잠재적인 성분을 추출하여 차원 축소->PCA는 여기에 해당!


> PCA의 원리 : 데이터의 분산을 가장 잘 표현할 수 있는 저차원을 찾아내는 것
![statweek_3](/git_stat/12.3.png)
👍 위 사진에서 3번 축이 가장 많은 분산을 담아내는 축이므로 주성분으로 채택

```
from sklearn.preprocessing import MinMaxScaler
from sklearn.ecomposition import PCA

# 데이터 스케일 정규화 -> 변수 간 스케일 차이가 클 경우 분산이 큰 변수가 주성분에 과도하게 영향을 많이 주기 때문
MinMaxScaler = MinMaxScaler()
df_minmax = MinMaxScaler.fit_transform(df1) # 스케일링을 하면 데이터가 넘파이 형식이 됨

# 컬럼명 결합
df_minmax = pd.DataFrame(data=df_minmax, columns = df1.columns)

# 주성분 개수 설정
pca = PCA(n_components=9) # 컬럼이 9개니까 최대치가 9
df_pca = pca.fit_transform(df_minmax)

# 주성분으로 변형된 테이블 생성
df_pca = pd.DataFrame(data=df_pca, columns = ['C1','C2','C3','C4','C5','C6','C7','C8','C9'])

# 주성분 설명력 확인
np.round_(pca.explained_variance_ratio_,3)

# 주성분 2개로 설정
pca = PCA(n_components=2)
df_pca = pca.fit_transform(df_minmax)
df_pca = pd.DataFrame(data=df_pca, columns = ['C1','C2'])

# 주성분에 따른 종속변수 시각화
df_concat = pd.concat([df_pca,df[['Type']]], axis = 1)

# 산점도 시각화
sns.scatterplot(data=df_concat, x = 'C1', y='C2', hue='Type')
```
![statweek_4](/git_stat/12.4.png)
> 이렇게 산점도를 그렸을 때 각각의 Type이 떨어져 있어야 분류 성능이 좋을 가능성이 높음

## 12.4. 다중공선성 해결과 섀플리 밸류 분석
> 두 개 이상의 독립변수가 서로 선형적인 관계를 나타낼 때 다중공선성이 있다고 말함

💡 다중공선성 판별 기준
1. 회귀 분석 모델을 실행하기 위해 상관분석을 통해 독립 변수 간 상관성을 확인하여 높은 상관계수를 갖는 독립변수 찾기(상관계수의 절대치가 0.7 이상이면 상관성이 높음)
2. 결정계수 값은 크지만 회귀변수에 대한 t값이 낮은 경우
3. VIF가 큰 변수는 다른 변수들과의 상관성이 높음

### 섀플리 밸류 분석
> 해당 변수를 모델에 투입했을 때 설명력에 어느 정도의 기여를 하는지 측정할 수 있는 기준값

## 12.6. Z-test와 T-test
> 두 집단 간의 평균 차이를 분석

⚠️ 조건
1. 양적 변수
2. 정규 분포
3. 등분산->bartlett 등분산성 검정을 통해 확인

![statweek_5](/git_stat/12.5.png)

- 평균 차이가 클수록, 표본의 수가 클수록 t값은 증가
- t값이 기각역 경계 안에 들어오면 대립가설을 기각하고 귀무가설을 채택

```
# 정규성 검정
shapiro(df['TypeA_before']) 

# 등분산성 검정
stats.bartlett(df['TypeA_before']) 

# Z-test(양측검정일 경우)
ztest(df['TypeA_before'], x2=df['TypeA_after'])

# t검정
ttest_ind(df['TypeA_before'], df['TypeB_before'], equal_var=False)
```

## 12.7. ANOVA
> 두 집단 이상의 평균 차이를 분석->각 집단의 평균값 차이가 통계적으로 유의한가?

> 집단 내 분산과 집단 평균의 분산이 사용됨

✅ t-test를 통해서 세 집단 이상 분석도 가능함! 하지만 이러한 경우 여러번 중복하여 검정하면 신뢰도가 하락함

- F분포(집단 간 분산의 비율)를 사용
- 독립변수는 범주형 변수, 종속변수는 연속형 변수여야 함
```
# 일원분산분석
F_statistic, pVal = stats.f_oneway(df['TypeA_before'], df['TypeB_before'], df['TypeC_before'])

# 데이터 재구조화
df2 = pd.melt(df) # variable/value 조합으로

# ols 패키지 아노바 검정
model = ols('value~C(variable)', df2).fit()
anova_lm(model)
```

## 12.8. 카이제곱 검정(교차분석)
> 범주형 변수들 간의 연관성을 분석하기 위해 결합분포를 활용

```
# 항목별 집계
df.groupby(['sex','smoke'])['smoke'].count() # sex와 smoke를 기준으로 smoke 카운트

# 교차표 가공
ct = pd.crosstab(df.sex, df.smoke)

# 막대그래프 시각화
ct.plot(kind='bar', figsize=(10,5))
plt.grid()

# 카이제곱 검정
chiresult = chi2_contigency(ct, correction=False)
print('Chi square : {}'.format(chiresult[0]))
print('P-value : {}'.format(chiresult[1]))
```



<br>
<br>

# 확인 문제

### **문제 1.**
> **🧚 경희는 다트비 교육 연구소의 연구원이다. 경희는 이번에 새롭게 개발한 교육 프로그램이 기존 프로그램보다 학습 성취도 향상에 효과적인지 검증하고자 100명의 학생을 무작위로 두 그룹으로 나누어 한 그룹(A)은 새로운 교육 프로그램을, 다른 그룹(B)은 기존 교육 프로그램을 수강하도록 하였다. 실험을 시작하기 전, 두 그룹(A, B)의 초기 시험 점수 평균을 비교한 결과, 유의미한 차이가 없었다. 8주 후, 학생들의 최종 시험 점수를 수집하여 두 그룹 간 평균 점수를 비교하려고 한다.**   

> **🔍 Q1. 이 실험에서 사용할 적절한 검정 방법은 무엇인가요?**

```
t-test
```

> **🔍 Q2. 이 실험에서 설정해야 할 귀무가설과 대립가설을 각각 작성하세요.**

```
귀무가설 : 두 그룹의 최종 시험 점수는 차이가 없다.
대립립가설 : 두 그룹의 최종 시험 점수는 차이가 있다.
```

> **🔍 Q3. 검정을 수행하기 위한 절차를 순서대로 서술하세요.**

<!--P.337의 실습 코드 흐름을 확인하여 데이터를 불러온 후부터 어떤 절차로 검정을 수행해야 하는지 고민해보세요.-->

```
1. 그룹별 통곗값 확인
2. 그룹별 박스 플롯 시각화->그룹별 차이 직관적으로 확인
3. 데이터 정규성 검정(shapiro)
4. 데이터 등분산성 검정(bartlett)
5. t-test
	- 등분산: equal variance t-test
	- 이분산: welch’s t-test
6. p-value와 임계치를 비교하여 결론론
```

> **🔍 Q4. 이 검정을 수행할 때 가정해야 하는 통계적 조건을 설명하세요.**

```
분석하고자 하는 변수가 양적 변수/정규분포/등분산
```

> **🔍 Q5. 추가적으로 최신 AI 기반 교육 프로그램(C)도 도입하여 기존 프로그램(B) 및 새로운 프로그램(A)과 비교하여 성취도 차이가 있는지 평가하고자 한다면 어떤 검정 방법을 사용해야 하나요? 단, 실험을 시작하기 전, C 그룹의 초기 점수 평균도 A, B 그룹과 유의미한 차이가 없었다고 가정한다.**

```
일원분산분석
```

> **🔍 Q6. 5번에서 답한 검정을 수행한 결과, 유의미한 차이가 나타났다면 추가적으로 어떤 검정을 수행해 볼 수 있을까요?**

```
사후검증(Turkey의 HSD검증, Schffe 검증 등)
```

---

### **문제 2. 카이제곱 검정**  
> **🧚 다음 중 어떠한 경우에 카이제곱 검정을 사용해야 하나요?   
1️⃣ 제품 A, B, C의 평균 매출 차이를 비교하고자 한다.  
2️⃣ 남성과 여성의 신체 건강 점수 평균 차이를 분석한다.  
3️⃣ 제품 구매 여부(구매/미구매)와 고객의 연령대(10대, 20대, 30대…) 간의 연관성을 분석한다.  
4️⃣ 특정 치료법이 환자의 혈압을 감소시키는 효과가 있는지 확인한다.**  

```
3️⃣ 제품 구매 여부(구매/미구매)와 고객의 연령대(10대, 20대, 30대…) 간의 연관성을 분석한다.
범주형 변수간의 연관성 분석이므로
```

### 🎉 수고하셨습니다.
